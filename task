import csv
import json
import os
from pathlib import Path

def update_tasklist(json_file: str | Path, csv_file: str | Path):
    """
    Updates the tasklist.csv file with token details from the JSON file.

    Args:
        json_file (str | Path): Path to the JSON file.
        csv_file (str | Path): Path to the tasklist.csv file.
    """
    
    with open(json_file, 'r') as f:
        data = json.load(f)

    with open(csv_file, 'r', newline='') as infile, open(f"{os.path.splitext(csv_file)[0]}_updated.csv", 'w', newline='') as outfile:
        reader = csv.reader(infile)
        writer = csv.writer(outfile)

        # Write the header row
        header = next(reader)
        header.extend(["prompt_template", "prompt_with_data", "model_input", "model_output", "model_total"])
        writer.writerow(header)

        for row in reader:
            # Extract path from the row
            path = row[2]
            
            # Find the matching element in the JSON data
            for item in data:
                if item['type'] + '/' + item['name'] == path:
                    token_details = item.get('token_Details', {})
                    row.extend([
                        token_details.get("prompt_template"),
                        token_details.get("prompt_with_data"),
                        token_details.get("model_input"),
                        token_details.get("model_output"),
                        token_details.get("model_total"),
                    ])
                    break

            writer.writerow(row)

# Example usage:
json_file = Path("./your_json_file.json")
csv_file = Path("./tasklist.csv")
update_tasklist(json_file, csv_file)
